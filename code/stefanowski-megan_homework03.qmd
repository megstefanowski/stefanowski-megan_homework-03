---
title: "stefanowski-megan_homework03"
format: html
date: 6/2/2024
editor: visual
author: Megan Stefanowski
---

forked repository: https://github.com/megstefanowski/stefanowski-megan_homework-03

# 1. Multiple linear regression

```{r}
# Load packages
library(tidyverse)
library(readxl)
library(here)
library(janitor)

# visualizing pairs
library(GGally)

# model selection
library(MuMIn)

# model predictions
library(ggeffects)

# model tables
library(gtsummary)
library(flextable)
library(modelsummary)
library(knitr)


# Load dataframe
drought_exp <- read_xlsx(path = "/Users/megstef/Desktop/ENVS-193DS/Git/new-repository/stefanowski-megan_homework-03/data/Valliere_etal_EcoApps_Data.xlsx", 
                         sheet = "First Harvest")

# quick look at data 
str(drought_exp)
class(drought_exp)
```

```{r}
# Cleaning data
drought_exp_clean <- drought_exp %>% 
  clean_names() %>% # nicer column names
  mutate(species_name = case_when( # adding column with species scientific names
    species == "ENCCAL" ~ "Encelia californica", # bush sunflower
    species == "ESCCAL" ~ "Eschscholzia californica", # California poppy
    species == "PENCEN" ~ "Penstemon centranthifolius", # Scarlet bugler
    species == "GRICAM" ~ "Grindelia camporum", # great valley gumweed
    species == "SALLEU" ~ "Salvia leucophylla", # Purple sage
    species == "STIPUL" ~ "Nasella pulchra", # Purple needlegrass
    species == "LOTSCO" ~ "Acmispon glaber" # deerweed
  )) %>% 
  relocate(species_name, .after = species) %>% # moving species_name column after species
  mutate(water_treatment = case_when( # adding column with full treatment names
    water == "WW" ~ "Well watered",
    water == "DS" ~ "Drought stressed"
  )) %>% 
  relocate(water_treatment, .after = water) # moving water_treatment column after water

# Preview clean data
head(drought_exp_clean)
```

## a. **Make a table *or* list of all the models from class and the last one you constructed on your own. Write a caption for your table.**

```{r}
# Constructing models
# null model
model0 <- lm(total_g ~ 1, # formula
             data = drought_exp_clean) # data frame

# model 1: SLA, treatment, and species 
model1 <- lm(total_g ~ sla + water_treatment + species_name,
             data = drought_exp_clean)
par(mfrow = c(2, 2))

# model 2: SLA and treatment
model2 <- lm(total_g ~ sla + water_treatment,
             data = drought_exp_clean)
# model 3: SLA and species
model3 <- lm(total_g ~ sla + species_name, 
             data = drought_exp_clean)
# model 4: treatment and species 
model4 <- lm(total_g ~ water_treatment + species_name, 
             data = drought_exp_clean)
```

```{r}
# Making a table

# Create data frame with all model information
model_info <- data.frame(
  Model_Number = c("0 (null)", "1 (saturated)", 2, 3, 4),
  Predictors = c("None", "SLA, treatment, species", "SLA, treatment", "SLA, species", "treatment, species")
)

# Make a table 
kable(model_info, # table
      caption = "Table 1: Comparing Predictive Models for Total Plant Biomass. This table summarizes five regression models, ranging from a null model (Model 0) with no predictors to four complex models incorporating various combinations of specific leaf area (SLA), water treatment, and species. Each row lists a model by its number and details the predictors used.", # caption 
      col.names = c("Model", "Predictors")) # label columns

```

## b. Write a 5-6 sentence "statistical methods" section

```{r}
# Make model selection table to assess AIC 
model.sel(model0,
          model1, 
          model2, 
          model3, 
          model4)

```

```{r}
# Look at diagnostic plots for model 4
par(mfrow = c(2, 2)) #display 4 plots in 2x2 grid
plot(model4) # base R residuals
```

```{r}
# Look at model 4 coefficents 
summary(model4)
```

To examine the influence of water treatment, plant species, and specific leaf area on total plant biomass, I constructed five linear regression models. To determine which model best described the variations in plant biomass, I used a model selection table to evaluate each model's Akaike Information Criterion (AIC). Model 4, which included the variables water treatment and species, had the lowest AIC, which suggested it might be the best model since it accounted for the most variance in biomass with the least complexity. To check that Model 4 conformed to the assumptions of linear regression--- linear relationship between variables, independent errors, homoscedasticity, and normality of residuals---I examined its diagnostic plots. The plots indicated that these conditions were likely met. I then looked at Model 4's coefficient summary to analyze it's slope, intercept, and level estimates, which revealed significant differences in biomass between well watered and drought treated conditions, as well as biomass variations across the different plant species.

## c. **Make a visualization of the model predictions with underlying data for your "best" model.**

```{r}
# calculate model predictions
model4_preds <- ggpredict(model4, 
                          terms = c("water_treatment", "species_name"))

# make visualization
ggplot(model4_preds, aes(x = x, y = predicted, color = x)) +  # plot model predictions
  geom_jitter(data = drought_exp_clean, # plot original underlying data
              aes(x = water_treatment, y = total_g, color = water_treatment), # assign variables
              width = 0.2, alpha = 0.2) +  # Adjust point size and set alpha = 0.2 for transparency
  geom_line() +
  geom_point(width = 0.1, alpha = 0.7) + # plot prediction points
  geom_errorbar(aes(ymin = conf.low, ymax = conf.high), width = 0.2, size = 0.4) + # add error bars
  labs(title = "Predicted Impact of Water Treatment and Species on Plant Biomass", # Title
       x = "Water treatment",  # Axis labels
       y = "Biomass (g)") + 
  scale_color_manual(name = "Water treatment", 
                     values = c("Well watered" = "Skyblue",  
                                "Drought stressed" = "Brown")) + # set colors
  facet_wrap(~ species_name) +
  theme_classic() + # set theme
  theme_classic(base_family = "Times") + # change font
  theme(panel.grid = element_blank(), # remove gridlines 
        axis.text.x = element_text(angle = 45, hjust = 1, size = 8),  # Adjust x axis text size and rotate for better readability
        legend.position = "none")  # Remove legend

```

## d. Write a caption for your visualization

This visualization illustrates the predicted effects of water treatment types---well watered and drought stressed---on the biomass of different plant species. Each point represents observed data points, while opaque lines and error bars indicate the model's predictions and their confidence intervals. The plot is faceted by species to clearly show the differential impact across species under varying water conditions.

Data from Valliere, Justin; Zhang, Jacqueline; Sharifi, M.; Rundel, Philip (2019).Dryad. https://doi.org/10.5061/dryad.v0861f7.

## 
